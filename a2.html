<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>금융 뉴스 - FinLearn</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Navigation */
        .nav {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        .nav-brand {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #667eea;
        }

        .nav-links a.active {
            color: #667eea;
            font-weight: bold;
        }

        .nav-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #667eea;
        }

        .level-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            animation: glowPulse 2s infinite;
        }

        @keyframes glowPulse {
            0%, 100% { 
                box-shadow: 0 0 5px currentColor;
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 20px currentColor, 0 0 30px currentColor;
                transform: scale(1.05);
            }
        }

        .glow {
            animation: glowPulse 2s infinite;
        }

        .level-yellow { background: #f39c12; }
        .level-orange { background: #e67e22; }
        .level-green { background: #27ae60; }
        .level-blue { background: #3498db; }
        .level-brown { background: #8b4513; }
        .level-black { background: #2c3e50; }
        .level-red { background: #e74c3c; }

        /* News Header */
        .news-header {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        .news-header h1 {
            color: #667eea;
            margin-bottom: 1rem;
        }

        .news-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #5a6fd8;
        }

        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .status-info {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #666;
        }

        .status-online {
            color: #27ae60;
        }

        .status-offline {
            color: #e74c3c;
        }

        /* News Grid */
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .news-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            transition: transform 0.3s;
        }

        .news-card:hover {
            transform: translateY(-5px);
        }

        .news-card h3 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .news-item {
            padding: 1rem 0;
            border-bottom: 1px solid #e1e1e1;
        }

        .news-item:last-child {
            border-bottom: none;
        }

        .news-item h4 {
            color: #333;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            line-height: 1.4;
        }

        .news-item p {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .news-item .meta {
            font-size: 0.8rem;
            color: #999;
            margin-top: 0.5rem;
        }

        .financial-term {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1rem;
        }

        .financial-term h4 {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .financial-term p {
            line-height: 1.5;
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .card-news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .card-news-item {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            font-size: 0.9rem;
        }

        .card-news-item h5 {
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="nav">
            <div class="nav-brand">💰 FinLearn</div>
            <ul class="nav-links">
                <li><a href="index.html">홈</a></li>
                <li><a href="a1.html">투자</a></li>
                <li><a href="a2.html" class="active">뉴스</a></li>
                <li><a href="a3.html">더보기</a></li>
                <li><a href="a4.html">게임</a></li>
                <li><a href="a5.html">등급</a></li>
            </ul>
            <div class="nav-profile">
                <img id="navProfileImg" class="profile-img" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23667eea'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='16'%3E👤%3C/text%3E%3C/svg%3E" alt="프로필">
                <span id="navLevelBadge" class="level-badge glow level-yellow">YELLOW</span>
            </div>
        </nav>

        <!-- News Header -->
        <div class="news-header">
            <h1>📰 금융 뉴스</h1>
            <p>최신 금융 뉴스와 용어를 학습하여 EXP를 획득하세요!</p>
            <div class="news-controls">
                <button id="refreshBtn" class="btn">뉴스 새로고침</button>
                <button id="autoRefreshBtn" class="btn">자동 새로고침 ON</button>
            </div>
            <div class="status-info">
                <div id="lastUpdate">마지막 업데이트: 로딩 중...</div>
                <div id="apiStatus" class="status-offline">API 상태: 연결 중...</div>
            </div>
        </div>

        <!-- News Grid -->
        <div class="news-grid">
            <!-- 오늘의 금융 용어 -->
            <div class="news-card">
                <h3>💡 오늘의 금융 용어</h3>
                <div id="todayTerm" class="financial-term">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>금융 용어를 불러오는 중...</p>
                    </div>
                </div>
            </div>

            <!-- 오늘의 뉴스레터 -->
            <div class="news-card">
                <h3>📧 오늘의 뉴스레터</h3>
                <div id="todayNewsletter">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>뉴스레터를 생성하는 중...</p>
                    </div>
                </div>
            </div>

            <!-- 금융 용어 공부하기 -->
            <div class="news-card">
                <h3>📚 금융 용어 공부하기</h3>
                <div id="studyTerms">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>금융 용어를 불러오는 중...</p>
                    </div>
                </div>
            </div>

            <!-- 주간 뉴스레터 -->
            <div class="news-card">
                <h3>📰 주간 뉴스레터</h3>
                <div id="weeklyNewsletter">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>주간 뉴스를 불러오는 중...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 카드뉴스 -->
        <div class="news-card">
            <h3>📱 카드뉴스</h3>
            <div id="cardNews" class="card-news-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>카드뉴스를 불러오는 중...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // News API Configuration
        const NEWS_API_KEY = 'YOUR_NEWS_API_KEY_HERE'; // Replace with actual API key
        const NEWS_API_URL = 'https://newsapi.org/v2/everything';
        
        // Auto refresh interval (10 minutes)
        const AUTO_REFRESH_INTERVAL = 10 * 60 * 1000;
        
        let autoRefreshTimer = null;
        let isAutoRefresh = false;

        // Financial terms fallback data
        const FINANCIAL_TERMS = [
            {
                term: "PER (Price Earnings Ratio)",
                definition: "주가수익비율. 주가를 주당순이익으로 나눈 값으로, 주식의 가치 평가 지표입니다."
            },
            {
                term: "PBR (Price Book Ratio)",
                definition: "주가순자산비율. 주가를 주당순자산으로 나눈 값으로, 주식의 저평가 여부를 판단하는 지표입니다."
            },
            {
                term: "ROE (Return On Equity)",
                definition: "자기자본이익률. 기업이 자기자본으로 얼마나 효율적으로 이익을 창출하는지 나타내는 지표입니다."
            },
            {
                term: "복리 (Compound Interest)",
                definition: "원금과 이자를 합한 금액에 대해 다시 이자가 계산되는 방식으로, 시간이 지날수록 이자가 급속히 증가합니다."
            },
            {
                term: "분산투자 (Diversification)",
                definition: "투자 위험을 줄이기 위해 여러 종목이나 자산군에 투자하는 전략입니다."
            },
            {
                term: "ETF (Exchange Traded Fund)",
                definition: "거래소에서 거래되는 펀드로, 특정 지수를 추종하는 투자상품입니다."
            },
            {
                term: "리밸런싱 (Rebalancing)",
                definition: "포트폴리오의 자산 비중을 원래 목표 비중으로 조정하는 과정입니다."
            },
            {
                term: "변동성 (Volatility)",
                definition: "주가나 자산 가격의 변동 정도를 나타내는 지표로, 투자 위험을 측정하는 기준입니다."
            }
        ];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            setupEventListeners();
            loadNewsData();
        });

        function initializePage() {
            // Load user interface if FinLearnUtils is available
            if (window.FinLearnUtils) {
                updateUserInterface();
            }
        }

        function setupEventListeners() {
            document.getElementById('refreshBtn').addEventListener('click', refreshNews);
            document.getElementById('autoRefreshBtn').addEventListener('click', toggleAutoRefresh);
        }

        function updateUserInterface() {
            const currentUser = getCurrentUser();
            if (currentUser && currentUser.isLoggedIn) {
                // Update profile image
                if (currentUser.profileImage) {
                    document.getElementById('navProfileImg').src = currentUser.profileImage;
                }
                
                // Update level badge
                const level = getLevelFromExp(currentUser.exp);
                updateLevelBadges(level);
            }
        }

        function getCurrentUser() {
            const userData = localStorage.getItem('currentUser');
            return userData ? JSON.parse(userData) : null;
        }

        function getLevelFromExp(exp) {
            const levels = ['yellow', 'orange', 'green', 'blue', 'brown', 'black', 'red'];
            const thresholds = [0, 3000, 6000, 10000, 15000, 25000, 50000];
            
            for (let i = levels.length - 1; i >= 0; i--) {
                if (exp >= thresholds[i]) {
                    return levels[i];
                }
            }
            return 'yellow';
        }

        function updateLevelBadges(level) {
            const levelNames = {
                yellow: 'YELLOW',
                orange: 'ORANGE', 
                green: 'GREEN',
                blue: 'BLUE',
                brown: 'BROWN',
                black: 'BLACK',
                red: 'RED'
            };
            
            const badge = document.getElementById('navLevelBadge');
            if (badge) {
                badge.textContent = levelNames[level];
                badge.className = `level-badge glow level-${level}`;
            }
        }

        async function loadNewsData() {
            try {
                setLoadingState(true);
                
                // Load financial terms
                loadFinancialTerms();
                
                // Try to load news from API
                const newsData = await fetchNewsData();
                
                if (newsData && newsData.articles && newsData.articles.length > 0) {
                    updateAPIStatus(true);
                    displayNewsContent(newsData.articles);
                } else {
                    throw new Error('No news data available');
                }
                
            } catch (error) {
                console.warn('News API error:', error);
                updateAPIStatus(false);
                displayFallbackContent();
            } finally {
                setLoadingState(false);
                updateLastUpdateTime();
            }
        }

        async function fetchNewsData() {
            if (NEWS_API_KEY === 'YOUR_NEWS_API_KEY_HERE') {
                throw new Error('API key not configured');
            }
            
            const params = new URLSearchParams({
                q: 'finance OR economy OR investment OR stock OR cryptocurrency',
                language: 'en',
                sortBy: 'publishedAt',
                pageSize: 20,
                apiKey: NEWS_API_KEY
            });
            
            const response = await fetch(`${NEWS_API_URL}?${params}`);
            
            if (!response.ok) {
                throw new Error(`API request failed: ${response.status}`);
            }
            
            return await response.json();
        }

        function displayNewsContent(articles) {
            // Generate AI summary for newsletter
            const aiSummary = generateAISummary(articles.slice(0, 5));
            
            // Display today's newsletter
            document.getElementById('todayNewsletter').innerHTML = `
                <div class="news-item">
                    <h4>📊 오늘의 금융 시장 요약</h4>
                    <p>${aiSummary}</p>
                    <div class="meta">AI 요약 • ${new Date().toLocaleDateString('ko-KR')}</div>
                </div>
            `;
            
            // Display weekly newsletter
            const weeklyArticles = articles.slice(0, 3);
            const weeklyHtml = weeklyArticles.map(article => `
                <div class="news-item">
                    <h4>${article.title}</h4>
                    <p>${article.description || '설명이 없습니다.'}</p>
                    <div class="meta">${new Date(article.publishedAt).toLocaleDateString('ko-KR')}</div>
                </div>
            `).join('');
            
            document.getElementById('weeklyNewsletter').innerHTML = weeklyHtml;
            
            // Display card news
            const cardNewsHtml = articles.slice(0, 6).map(article => `
                <div class="card-news-item">
                    <h5>${truncateText(article.title, 50)}</h5>
                    <p>${truncateText(article.description || '설명이 없습니다.', 80)}</p>
                </div>
            `).join('');
            
            document.getElementById('cardNews').innerHTML = cardNewsHtml;
            
            // Add EXP for reading news
            if (window.FinLearnUtils) {
                window.FinLearnUtils.addExp(50);
            }
        }

        function displayFallbackContent() {
            // Display fallback newsletter
            document.getElementById('todayNewsletter').innerHTML = `
                <div class="news-item">
                    <h4>📊 금융 시장 기본 가이드</h4>
                    <p>오늘은 기본적인 투자 원칙들을 되새겨보는 시간을 가져보세요. 분산투자, 장기투자, 그리고 꾸준한 학습이 성공적인 투자의 핵심입니다.</p>
                    <div class="meta">기본 가이드 • ${new Date().toLocaleDateString('ko-KR')}</div>
                </div>
            `;
            
            // Display fallback weekly news
            document.getElementById('weeklyNewsletter').innerHTML = `
                <div class="news-item">
                    <h4>투자 기초: 리스크 관리</h4>
                    <p>투자에서 가장 중요한 것은 리스크 관리입니다. 모든 계란을 한 바구니에 담지 마세요.</p>
                    <div class="meta">${new Date().toLocaleDateString('ko-KR')}</div>
                </div>
                <div class="news-item">
                    <h4>복리의 마법</h4>
                    <p>복리는 시간이 지날수록 그 효과가 기하급수적으로 증가합니다. 꾸준한 투자가 중요한 이유입니다.</p>
                    <div class="meta">${new Date().toLocaleDateString('ko-KR')}</div>
                </div>
            `;
            
            // Display fallback card news
            const fallbackCards = [
                { title: "금융 상식", content: "투자는 여유자금으로 하세요" },
                { title: "투자 원칙", content: "분산투자로 리스크를 줄이세요" },
                { title: "장기 투자", content: "시간이 여러분의 편입니다" },
                { title: "금융 교육", content: "꾸준한 학습이 성공의 열쇠입니다" }
            ];
            
            const cardNewsHtml = fallbackCards.map(card => `
                <div class="card-news-item">
                    <h5>${card.title}</h5>
                    <p>${card.content}</p>
                </div>
            `).join('');
            
            document.getElementById('cardNews').innerHTML = cardNewsHtml;
        }

        function loadFinancialTerms() {
            // Today's term (rotate daily)
            const today = new Date();
            const dayIndex = today.getDate() % FINANCIAL_TERMS.length;
            const todayTerm = FINANCIAL_TERMS[dayIndex];
            
            document.getElementById('todayTerm').innerHTML = `
                <h4>${todayTerm.term}</h4>
                <p>${todayTerm.definition}</p>
            `;
            
            // Study terms (show 3 random terms)
            const shuffledTerms = [...FINANCIAL_TERMS].sort(() => Math.random() - 0.5).slice(0, 3);
            const studyHtml = shuffledTerms.map(term => `
                <div class="news-item">
                    <h4>${term.term}</h4>
                    <p>${term.definition}</p>
                </div>
            `).join('');
            
            document.getElementById('studyTerms').innerHTML = studyHtml;
            
            // Add EXP for learning terms
            if (window.FinLearnUtils) {
                window.FinLearnUtils.addExp(20);
            }
        }

        function generateAISummary(articles) {
            if (!articles || articles.length === 0) {
                return "오늘의 금융 시장은 안정적인 모습을 보이고 있습니다. 투자자들은 신중한 접근을 유지하고 있으며, 장기적인 관점에서의 투자 전략이 중요해 보입니다.";
            }
            
            // Simple AI summary stub - combine top titles and create summary
            const keywords = [];
            articles.forEach(article => {
                const title = article.title.toLowerCase();
                if (title.includes('stock') || title.includes('market')) keywords.push('주식시장');
                if (title.includes('crypto') || title.includes('bitcoin')) keywords.push('암호화폐');
                if (title.includes('economy') || title.includes('economic')) keywords.push('경제');
                if (title.includes('finance') || title.includes('financial')) keywords.push('금융');
                if (title.includes('investment')) keywords.push('투자');
            });
            
            const uniqueKeywords = [...new Set(keywords)];
            const keywordText = uniqueKeywords.length > 0 ? uniqueKeywords.join(', ') : '금융시장';
            
            return `오늘의 주요 이슈는 ${keywordText} 관련 뉴스들이 주를 이루고 있습니다. ${articles[0].title}을 비롯하여 다양한 금융 뉴스들이 보도되고 있으며, 투자자들의 관심이 높아지고 있습니다. 신중한 투자 판단이 필요한 시점입니다.`;
        }

        function refreshNews() {
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.disabled = true;
            refreshBtn.textContent = '새로고침 중...';
            
            loadNewsData().finally(() => {
                refreshBtn.disabled = false;
                refreshBtn.textContent = '뉴스 새로고침';
            });
        }

        function toggleAutoRefresh() {
            const btn = document.getElementById('autoRefreshBtn');
            
            if (isAutoRefresh) {
                // Turn off auto refresh
                clearInterval(autoRefreshTimer);
                isAutoRefresh = false;
                btn.textContent = '자동 새로고침 ON';
                btn.style.background = '#667eea';
            } else {
                // Turn on auto refresh
                autoRefreshTimer = setInterval(loadNewsData, AUTO_REFRESH_INTERVAL);
                isAutoRefresh = true;
                btn.textContent = '자동 새로고침 OFF';
                btn.style.background = '#27ae60';
            }
        }

        function setLoadingState(isLoading) {
            // Update loading states would be handled by individual sections
        }

        function updateAPIStatus(isOnline) {
            const statusElement = document.getElementById('apiStatus');
            if (isOnline) {
                statusElement.textContent = 'API 상태: 연결됨';
                statusElement.className = 'status-online';
            } else {
                statusElement.textContent = 'API 상태: 오프라인 (fallback 사용)';
                statusElement.className = 'status-offline';
            }
        }

        function updateLastUpdateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `마지막 업데이트: ${now.toLocaleString('ko-KR')}`;
        }

        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // Initialize auto refresh on page load
        toggleAutoRefresh();
    </script>
</body>
</html>