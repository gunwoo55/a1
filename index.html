<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- ìºì‹œ ë¬´ë ¥í™” ë©”íƒ€íƒœê·¸ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-buster" content="v2.3.0-20250809">
    
    <title>FINE U - ì‹¤ì‹œê°„ ì—°ë™ ëª¨ì˜íˆ¬ì ì•±</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css?v=2.3.0" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css?v=2.3.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js?v=2.3.0"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            zoom: 1;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }
        .screen {
            display: none;
            min-height: 100vh;
            position: relative;
        }
        .screen.active {
            display: block;
        }
        .card-shadow {
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #4A6FA5, #6B8DC7);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 111, 165, 0.3);
        }
        .stock-item {
            transition: all 0.3s ease;
        }
        .stock-item:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .profit { color: #DC2626; }
        .loss { color: #2563EB; }
        
        .level-badge-profile {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .level-badge-nav {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 12px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10;
            cursor: pointer;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        .level-yellow { background: linear-gradient(135deg, #FCD34D, #F59E0B); }
        .level-orange { background: linear-gradient(135deg, #FB923C, #EA580C); }
        .level-green { background: linear-gradient(135deg, #34D399, #059669); }
        .level-blue { background: linear-gradient(135deg, #60A5FA, #2563EB); }
        .level-brown { background: linear-gradient(135deg, #A16207, #92400E); }
        .level-black { background: linear-gradient(135deg, #374151, #111827); }
        .level-red { background: linear-gradient(135deg, #EF4444, #DC2626); }
        
        @keyframes glow {
            from {
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            }
            to {
                box-shadow: 0 4px 20px rgba(0,0,0,0.3), 0 0 15px rgba(255,255,255,0.3);
            }
        }
        
        .asset-category {
            border-left: 4px solid;
        }
        .asset-stock { border-color: #3B82F6; }
        .asset-bond { border-color: #10B981; }
        .asset-deposit { border-color: #8B5CF6; }
        .asset-etf { border-color: #F59E0B; }
        .asset-crypto { border-color: #EF4444; }
        .asset-commodity { border-color: #6B7280; }
        .asset-cash { border-color: #6B7280; }
        
        .modal {
            backdrop-filter: blur(10px);
        }
        
        .profile-image {
            width: 80px;
            height: 80px;
            border-radius: 16px;
            object-fit: cover;
            border: 3px solid #e5e7eb;
        }
        
        .login-container {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 280px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .level-up-animation {
            animation: levelUp 2s ease-in-out;
        }
        
        @keyframes levelUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }
        
        .error-state {
            text-align: center;
            padding: 40px 20px;
            color: #ef4444;
        }

        .bottom-navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            padding: 12px 0 8px 0;
            z-index: 50;
        }

        .nav-container {
            max-width: 28rem;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            align-items: end;
            position: relative;
            height: 60px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 4px;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-item:hover {
            transform: translateY(-1px);
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-item span {
            font-size: 11px;
            font-weight: 500;
        }

        .nav-item.active i {
            color: #3B82F6;
        }

        .nav-item.active span {
            color: #3B82F6;
        }

        .nav-center {
            grid-column: 3;
            display: flex;
            justify-content: center;
            align-items: end;
            height: 100%;
            position: relative;
        }

        .profile-menu {
            position: fixed;
            top: 80px;
            right: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            padding: 12px;
            display: none;
            z-index: 100;
            min-width: 150px;
        }

        .profile-menu.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .profile-menu-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .profile-menu-item:hover {
            background-color: #f3f4f6;
        }

        .profile-menu-item i {
            margin-right: 8px;
            width: 16px;
            text-align: center;
        }

        .real-time-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #10B981;
            border-radius: 50%;
            animation: pulse 2s infinite;
            margin-right: 4px;
        }

        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
            
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }
    </style>
</head>
<body>

<!-- ë¡œê·¸ì¸ í™”ë©´ -->
<div id="loginScreen" class="screen active">
    <div class="min-h-screen relative">
        <img src="https://page.gensparksite.com/v1/base64_upload/d70cd4313a281cd622151fc21c31a361" 
             alt="Login Background" 
             class="absolute inset-0 w-full h-full object-cover">
        
        <div class="login-container">
            <div class="space-y-3">
                <input type="text" id="userId" placeholder="ID" 
                       class="w-full px-4 py-2.5 rounded-lg bg-white bg-opacity-90 border-0 text-gray-800 placeholder-gray-500 text-sm">
                <input type="password" id="userPassword" placeholder="PASSWORD" 
                       class="w-full px-4 py-2.5 rounded-lg bg-white bg-opacity-90 border-0 text-gray-800 placeholder-gray-500 text-sm">
                <button onclick="performLogin()" 
                        class="w-full py-2.5 btn-primary text-white rounded-lg font-medium text-sm">
                    ë¡œê·¸ì¸
                </button>
            </div>
            <div class="text-center mt-4">
                <a href="#" onclick="showRegisterModal()" class="text-white text-xs underline opacity-90">íšŒì›ê°€ì…</a>
                <span class="text-white mx-2 text-xs opacity-90">|</span>
                <a href="#" onclick="showFindModal()" class="text-white text-xs underline opacity-90">ì•„ì´ë”” & ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
            </div>
            <!-- íŠ¹ë³„ ê³„ì • ì•ˆë‚´ -->
            <div class="text-center mt-3">
                <p class="text-white text-xs opacity-75">ğŸ’¡ ì²´í—˜ê³„ì •: test / test (BLACK ë“±ê¸‰, 1ì–µì›)</p>
            </div>
        </div>
    </div>
</div>

<!-- ë©”ì¸ í™”ë©´ -->
<div id="mainScreen" class="screen">
    <div class="min-h-screen bg-gray-100">
        <!-- ìƒë‹¨ í—¤ë” -->
        <div class="bg-white shadow-sm p-4">
            <div class="flex items-center justify-between max-w-md mx-auto">
                <div class="flex items-center space-x-2">
                    <span class="real-time-indicator"></span>
                    <i class="fas fa-star text-yellow-400 text-lg"></i>
                    <h1 class="text-2xl font-bold text-blue-400">FINE U</h1>
                    <span class="text-xs text-green-600">LIVE</span>
                </div>
                <button onclick="toggleProfileMenu()" class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                    <img id="headerProfileImage" src="" alt="Profile" class="w-10 h-10 rounded-full object-cover hidden">
                    <i id="headerProfileIcon" class="fas fa-user text-blue-400"></i>
                </button>
            </div>
        </div>

        <!-- í”„ë¡œí•„ ë©”ë‰´ -->
        <div id="profileMenu" class="profile-menu">
            <div class="profile-menu-item" onclick="showProfileModal()">
                <i class="fas fa-user"></i>
                <span>í”„ë¡œí•„ ì„¤ì •</span>
            </div>
            <div class="profile-menu-item" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>ë¡œê·¸ì•„ì›ƒ</span>
            </div>
        </div>

        <!-- í”„ë¡œí•„ ì„¹ì…˜ -->
        <div class="max-w-md mx-auto px-4 py-6">
            <div class="bg-white rounded-2xl p-6 card-shadow mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold">PROFILE</h2>
                    <i class="fas fa-paperclip text-gray-400"></i>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <img id="profileImage" src="" alt="Profile" class="profile-image hidden">
                        <div id="profilePlaceholder" class="w-20 h-20 bg-blue-100 rounded-2xl flex items-center justify-center">
                            <i class="fas fa-user text-blue-400 text-2xl"></i>
                        </div>
                        <button onclick="uploadProfileImage()" class="absolute -bottom-1 -right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-camera text-white text-xs"></i>
                        </button>
                        <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                    </div>
                    <div class="flex-1">
                        <div id="userLevel" class="level-badge-profile level-yellow mb-2">
                            YELLOW
                        </div>
                        <p class="font-bold text-gray-800" id="userName">ì‚¬ìš©ì</p>
                        <p class="text-xs text-gray-500" id="userExp">0 / 3000 EXP</p>
                    </div>
                </div>
            </div>

            <!-- ìì‚° í˜„í™© -->
            <div class="bg-white rounded-2xl p-6 card-shadow mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold">ASSETS</h2>
                    <button onclick="refreshAssets()" class="text-blue-500">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="bg-blue-50 rounded-xl p-4 mb-4">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="fas fa-star text-yellow-400"></i>
                        <span class="text-2xl font-bold text-gray-800" id="totalAssets">10,000,000ì›</span>
                    </div>
                    <div class="text-sm">
                        <span class="text-gray-600">í‰ê°€ì†ìµ: </span>
                        <span id="totalProfitLoss" class="font-semibold text-green-600">+0ì› (0.00%)</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1">
                        í˜„ê¸ˆ: <span id="cashAmount">10,000,000ì›</span>
                    </div>
                </div>
                <div id="assetsList" class="space-y-3">
                    <!-- ìì‚° ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- í¬íŠ¸í´ë¦¬ì˜¤ ì„¹ì…˜ -->
            <div class="bg-white rounded-2xl p-6 card-shadow mb-24">
                <h2 class="text-xl font-bold mb-4">PORTFOLIO</h2>
                <div class="relative mb-4">
                    <canvas id="portfolioChart" style="height: 200px;"></canvas>
                </div>
                <div id="portfolioDetails" class="space-y-3">
                    <!-- í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="bottom-navigation">
            <div class="nav-container">
                <button onclick="showMainScreen()" class="nav-item active">
                    <i class="fas fa-home"></i>
                    <span>í™ˆ</span>
                </button>
                <button onclick="navigateToPage('a2.html')" class="nav-item">
                    <i class="fas fa-newspaper text-gray-400"></i>
                    <span class="text-gray-400">ë‰´ìŠ¤</span>
                </button>
                <div class="nav-center">
                    <div id="navLevelBadge" class="level-badge-nav level-yellow" onclick="navigateToPage('a5.html')">
                        YELLOW
                    </div>
                </div>
                <button onclick="navigateToPage('a4.html')" class="nav-item">
                    <i class="fas fa-gamepad text-gray-400"></i>
                    <span class="text-gray-400">ê²Œì„</span>
                </button>
                <button onclick="navigateToPage('a3.html')" class="nav-item">
                    <i class="fas fa-ellipsis-h text-gray-400"></i>
                    <span class="text-gray-400">ë”ë³´ê¸°</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- íšŒì›ê°€ì… ëª¨ë‹¬ -->
<div id="registerModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden z-50">
    <div class="flex items-center justify-center min-h-screen">
        <div class="bg-white rounded-2xl w-full max-w-sm mx-4 p-6">
            <div class="text-center mb-6">
                <h3 class="text-xl font-bold">íšŒì›ê°€ì…</h3>
            </div>
            <div class="space-y-4 mb-6">
                <input type="text" id="registerUserId" placeholder="ì•„ì´ë””" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                <input type="password" id="registerPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                <input type="password" id="registerPasswordConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                <input type="text" id="registerName" placeholder="ì´ë¦„" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="hideRegisterModal()" 
                        class="bg-gray-300 text-gray-700 py-3 rounded-xl font-semibold">
                    ì·¨ì†Œ
                </button>
                <button onclick="register()" 
                        class="bg-blue-500 text-white py-3 rounded-xl font-semibold">
                    ê°€ì…
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ëª¨ë‹¬ -->
<div id="findModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden z-50">
    <div class="flex items-center justify-center min-h-screen">
        <div class="bg-white rounded-2xl w-full max-w-sm mx-4 p-6">
            <div class="text-center mb-6">
                <h3 class="text-xl font-bold">ê³„ì • ì°¾ê¸°</h3>
            </div>
            <div class="space-y-4 mb-6">
                <input type="text" id="findName" placeholder="ì´ë¦„" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                <input type="email" id="findEmail" placeholder="ì´ë©”ì¼" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="hideFindModal()" 
                        class="bg-gray-300 text-gray-700 py-3 rounded-xl font-semibold">
                    ì·¨ì†Œ
                </button>
                <button onclick="findAccount()" 
                        class="bg-blue-500 text-white py-3 rounded-xl font-semibold">
                    ì°¾ê¸°
                </button>
            </div>
        </div>
    </div>
</div>

<!-- í”„ë¡œí•„ ëª¨ë‹¬ -->
<div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden z-50">
    <div class="flex items-center justify-center min-h-screen">
        <div class="bg-white rounded-2xl w-full max-w-sm mx-4 p-6">
            <div class="text-center mb-6">
                <h3 class="text-xl font-bold">í”„ë¡œí•„ ì„¤ì •</h3>
            </div>
            <div class="text-center mb-6">
                <div class="relative inline-block">
                    <img id="modalProfileImage" src="" alt="Profile" class="profile-image hidden mx-auto">
                    <div id="modalProfilePlaceholder" class="w-20 h-20 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto">
                        <i class="fas fa-user text-blue-400 text-2xl"></i>
                    </div>
                    <button onclick="uploadProfileImageFromModal()" class="absolute -bottom-1 -right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-camera text-white text-xs"></i>
                    </button>
                </div>
                <p class="mt-2 text-sm text-gray-500">í”„ë¡œí•„ ì‚¬ì§„ì„ ë³€ê²½í•˜ë ¤ë©´ ì¹´ë©”ë¼ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</p>
            </div>
            <div class="space-y-4 mb-6">
                <input type="text" id="modalUserName" placeholder="ì´ë¦„" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="hideProfileModal()" 
                        class="bg-gray-300 text-gray-700 py-3 rounded-xl font-semibold">
                    ì·¨ì†Œ
                </button>
                <button onclick="updateProfile()" 
                        class="bg-blue-500 text-white py-3 rounded-xl font-semibold">
                    ì €ì¥
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// ì „ì—­ ë³€ìˆ˜
var currentUser = null;
var userAssets = {};
var userLevel = 'yellow';
var userExp = 0;
var totalAssets = 10000000;
var cash = 10000000;
var portfolioChart = null;
var dataRefreshInterval = null;

// ì‹¤ì‹œê°„ ê°€ê²© ë°ì´í„° (2025ë…„ 8ì›” 9ì¼ ê¸°ì¤€)
var realTimePrices = {
    stock: {
        'samsung': { price: 74500, change: 1.85 },
        'sk_hynix': { price: 189000, change: -0.95 },
        'naver': { price: 168500, change: 2.34 },
        'kakao': { price: 58900, change: -1.67 },
        'apple': { price: 225.45, change: 0.78 }
    },
    crypto: {
        'bitcoin': { price: 62847000, change: 2.14 },
        'ethereum': { price: 3245000, change: -1.23 },
        'ripple': { price: 780, change: 5.67 }
    },
    commodity: {
        'gold': { price: 87500, change: 0.65 },
        'silver': { price: 1250, change: -1.15 },
        'oil': { price: 112000, change: 2.34 }
    }
};

// ë ˆë²¨ ì‹œìŠ¤í…œ ì„¤ì •
var levelSystem = {
    yellow: { name: 'YELLOW', exp: 0, max: 3000, class: 'level-yellow' },
    orange: { name: 'ORANGE', exp: 3000, max: 6000, class: 'level-orange' },
    green: { name: 'GREEN', exp: 6000, max: 10000, class: 'level-green' },
    blue: { name: 'BLUE', exp: 10000, max: 15000, class: 'level-blue' },
    brown: { name: 'BROWN', exp: 15000, max: 25000, class: 'level-brown' },
    black: { name: 'BLACK', exp: 25000, max: 50000, class: 'level-black' },
    red: { name: 'RED', exp: 50000, max: 100000, class: 'level-red' }
};

// í˜ì´ì§€ ì´ë™ í•¨ìˆ˜ (ìºì‹œ ë¬´ë ¥í™” ì ìš©)
function navigateToPage(page) {
    try {
        // í˜„ì¬ ì‹œê°„ì„ ì´ìš©í•œ ìºì‹œ ë²„ìŠ¤í„°
        var cacheBuster = '?v=' + new Date().getTime();
        var currentHost = window.location.origin;
        var targetUrl = currentHost + '/' + page + cacheBuster;
        
        // ì‚¬ìš©ì ë°ì´í„° ì €ì¥
        saveUserData();
        
        // í˜ì´ì§€ ì´ë™
        window.location.href = targetUrl;
    } catch (error) {
        console.error('í˜ì´ì§€ ì´ë™ ì˜¤ë¥˜:', error);
        // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ ì´ë™
        window.location.href = page;
    }
}

// ìë™ ë¡œê·¸ì¸ í™•ì¸
function checkAutoLogin() {
    try {
        var savedUser = localStorage.getItem('fineu_current_user');
        if (savedUser) {
            var userData = JSON.parse(savedUser);
            if (userData.id) {
                // ìë™ ë¡œê·¸ì¸ ì‹¤í–‰
                showMainScreen(userData.id);
                return true;
            }
        }
    } catch (error) {
        console.error('ìë™ ë¡œê·¸ì¸ í™•ì¸ ì˜¤ë¥˜:', error);
    }
    return false;
}

// ë¡œê·¸ì¸ í•¨ìˆ˜ (íŠ¹ë³„ ê³„ì • ì²˜ë¦¬ ì¶”ê°€)
function performLogin() {
    try {
        var userId = document.getElementById('userId');
        var password = document.getElementById('userPassword');
        
        if (!userId || !password) {
            alert('ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        var userIdValue = userId.value.trim();
        var passwordValue = password.value.trim();
        
        if (!userIdValue || !passwordValue) {
            alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }
        
        // íŠ¹ë³„ ê³„ì • í™•ì¸
        if (userIdValue === 'test' && passwordValue === 'test') {
            showMainScreenWithSpecialAccount(userIdValue);
        } else {
            showMainScreen(userIdValue);
        }
    } catch (error) {
        console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
        alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}

// íŠ¹ë³„ ê³„ì • ë©”ì¸ í™”ë©´ í‘œì‹œ
function showMainScreenWithSpecialAccount(userId) {
    try {
        setupSpecialUser(userId);
        
        var loginScreen = document.getElementById('loginScreen');
        var mainScreen = document.getElementById('mainScreen');
        
        if (loginScreen) {
            loginScreen.classList.remove('active');
        }
        
        if (mainScreen) {
            mainScreen.classList.add('active');
        }
        
        updateDisplay();
        startDataRefresh();
        
        // íŠ¹ë³„ ê³„ì • í™˜ì˜ ë©”ì‹œì§€
        setTimeout(function() {
            alert('ğŸ‰ íŠ¹ë³„ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!\nBLACK ë“±ê¸‰ì—ì„œ ì‹œì‘í•˜ë©° ëª¨ë“  íˆ¬ì ê¸°ëŠ¥ì´ í•´ì œë©ë‹ˆë‹¤.\nê°€ìƒ ìì‚°: 1ì–µì›');
        }, 500);
        
    } catch (error) {
        console.error('íŠ¹ë³„ ê³„ì • í™”ë©´ ì „í™˜ ì˜¤ë¥˜:', error);
    }
}

// íŠ¹ë³„ ì‚¬ìš©ì ì´ˆê¸°í™”
function setupSpecialUser(userId) {
    try {
        currentUser = {
            id: userId,
            name: 'í…ŒìŠ¤íŠ¸ íˆ¬ìì',
            level: 'black',
            exp: 25000,
            virtualBalance: 100000000, // 1ì–µì›ìœ¼ë¡œ ì‹œì‘
            cash: 100000000,
            totalAssets: 100000000,
            portfolio: {
                deposit: [],
                stock: [],
                bond: [],
                etf: [],
                crypto: [],
                commodity: []
            },
            transactions: [],
            profileImage: null
        };
        
        userLevel = 'black';
        userExp = 25000;
        totalAssets = 100000000;
        cash = 100000000;
        userAssets = {};
        
        // í˜„ì¬ ì‚¬ìš©ì ì €ì¥
        localStorage.setItem('fineu_current_user', JSON.stringify(currentUser));
        localStorage.setItem('user_' + currentUser.id, JSON.stringify(currentUser));
        
    } catch (error) {
        console.error('íŠ¹ë³„ ì‚¬ìš©ì ì„¤ì • ì˜¤ë¥˜:', error);
    }
}

// ë©”ì¸ í™”ë©´ í‘œì‹œ
function showMainScreen(userId) {
    try {
        if (userId) {
            setupUser(userId);
        }
        
        var loginScreen = document.getElementById('loginScreen');
        var mainScreen = document.getElementById('mainScreen');
        
        if (loginScreen) {
            loginScreen.classList.remove('active');
        }
        
        if (mainScreen) {
            mainScreen.classList.add('active');
        }
        
        updateDisplay();
        startDataRefresh();
    } catch (error) {
        console.error('í™”ë©´ ì „í™˜ ì˜¤ë¥˜:', error);
    }
}

// ì‚¬ìš©ì ì´ˆê¸°í™”
function setupUser(userId) {
    try {
        // ê¸°ë³¸ ì‚¬ìš©ì ë°ì´í„°
        currentUser = {
            id: userId,
            name: userId,
            level: 'yellow',
            exp: 0,
            virtualBalance: 10000000,
            cash: 10000000,
            totalAssets: 10000000,
            portfolio: {
                deposit: [],
                stock: [],
                bond: [],
                etf: [],
                crypto: [],
                commodity: []
            },
            transactions: [],
            profileImage: null
        };
        
        // ê¸°ì¡´ ì‚¬ìš©ì ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        var savedData = localStorage.getItem('user_' + userId);
        if (savedData) {
            var userData = JSON.parse(savedData);
            currentUser = Object.assign(currentUser, userData);
        }
        
        // ì „ì—­ ë³€ìˆ˜ ë™ê¸°í™”
        userLevel = currentUser.level || 'yellow';
        userExp = currentUser.exp || 0;
        totalAssets = currentUser.totalAssets || 10000000;
        cash = currentUser.cash || 10000000;
        userAssets = {}; // í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ê³„ì‚°
        
        // í¬íŠ¸í´ë¦¬ì˜¤ ë°ì´í„° ë™ê¸°í™”
        syncPortfolioData();
        
        // í˜„ì¬ ì‚¬ìš©ì ì €ì¥
        localStorage.setItem('fineu_current_user', JSON.stringify(currentUser));
        
    } catch (error) {
        console.error('ì‚¬ìš©ì ì„¤ì • ì˜¤ë¥˜:', error);
    }
}

// í¬íŠ¸í´ë¦¬ì˜¤ ë°ì´í„° ë™ê¸°í™”
function syncPortfolioData() {
    try {
        if (!currentUser.portfolio) {
            currentUser.portfolio = {
                deposit: [],
                stock: [],
                bond: [],
                etf: [],
                crypto: [],
                commodity: []
            };
        }
        
        // í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ì´ ìì‚° ê³„ì‚°
        var portfolioValue = 0;
        
        Object.keys(currentUser.portfolio).forEach(function(type) {
            currentUser.portfolio[type].forEach(function(holding) {
                var currentPrice = getCurrentPrice(type, holding.productId);
                if (currentPrice > 0) {
                    portfolioValue += holding.quantity * currentPrice;
                }
            });
        });
        
        totalAssets = portfolioValue + cash;
        currentUser.totalAssets = totalAssets;
        
    } catch (error) {
        console.error('í¬íŠ¸í´ë¦¬ì˜¤ ë™ê¸°í™” ì˜¤ë¥˜:', error);
    }
}

// í˜„ì¬ ê°€ê²© ì¡°íšŒ
function getCurrentPrice(type, productId) {
    try {
        // ì‹¤ì‹œê°„ ê°€ê²© ë°ì´í„°ì—ì„œ ì¡°íšŒ
        var priceData = realTimePrices[type];
        if (priceData && priceData[productId]) {
            return priceData[productId].price;
        }
        
        // ê¸°ë³¸ê°’ ë°˜í™˜
        return 100000; // ê¸°ë³¸ ê°€ê²©
    } catch (error) {
        console.error('ê°€ê²© ì¡°íšŒ ì˜¤ë¥˜:', error);
        return 100000;
    }
}

// ì‹¤ì‹œê°„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘
function startDataRefresh() {
    // 5ì´ˆë§ˆë‹¤ ì‹¤ì‹œê°„ ê°€ê²© ì—…ë°ì´íŠ¸
    dataRefreshInterval = setInterval(function() {
        updateRealTimePrices();
        syncPortfolioData();
        updateAssetsDisplay();
        updatePortfolioDisplay();
    }, 5000);
}

// ì‹¤ì‹œê°„ ê°€ê²© ì—…ë°ì´íŠ¸
function updateRealTimePrices() {
    try {
        // ì£¼ì‹ ê°€ê²© ì—…ë°ì´íŠ¸ (Â±2% ë³€ë™)
        Object.keys(realTimePrices.stock).forEach(function(key) {
            var stock = realTimePrices.stock[key];
            var variation = (Math.random() - 0.5) * 4; // -2% ~ +2%
            var changeAmount = stock.price * (variation / 100);
            
            stock.price = Math.max(1000, stock.price + changeAmount);
            stock.change = variation;
        });
        
        // ì•”í˜¸í™”í ê°€ê²© ì—…ë°ì´íŠ¸ (Â±5% ë³€ë™)
        Object.keys(realTimePrices.crypto).forEach(function(key) {
            var crypto = realTimePrices.crypto[key];
            var variation = (Math.random() - 0.5) * 10; // -5% ~ +5%
            var changeAmount = crypto.price * (variation / 100);
            
            crypto.price = Math.max(100, crypto.price + changeAmount);
            crypto.change = variation;
        });
        
        // ì›ìì¬ ê°€ê²© ì—…ë°ì´íŠ¸ (Â±1% ë³€ë™)
        Object.keys(realTimePrices.commodity).forEach(function(key) {
            var commodity = realTimePrices.commodity[key];
            var variation = (Math.random() - 0.5) * 2; // -1% ~ +1%
            var changeAmount = commodity.price * (variation / 100);
            
            commodity.price = Math.max(1000, commodity.price + changeAmount);
            commodity.change = variation;
        });
        
    } catch (error) {
        console.error('ì‹¤ì‹œê°„ ê°€ê²© ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
    }
}

// í™”ë©´ í‘œì‹œ ì—…ë°ì´íŠ¸
function updateDisplay() {
    try {
        if (!currentUser) return;
        
        // ì‚¬ìš©ì ì´ë¦„ ì—…ë°ì´íŠ¸
        var userNameElement = document.getElementById('userName');
        if (userNameElement) {
            userNameElement.textContent = currentUser.name;
        }
        
        // í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
        updateProfileImage();
        
        // ë ˆë²¨ ì—…ë°ì´íŠ¸
        updateLevelDisplay();
        
        // ìì‚° ì—…ë°ì´íŠ¸
        updateAssetsDisplay();
        
        // í¬íŠ¸í´ë¦¬ì˜¤ ì—…ë°ì´íŠ¸
        updatePortfolioDisplay();
        
    } catch (error) {
        console.error('í™”ë©´ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
    }
}

// í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
function updateProfileImage() {
    try {
        if (!currentUser) return;
        
        var profileImage = document.getElementById('profileImage');
        var profilePlaceholder = document.getElementById('profilePlaceholder');
        var headerProfileImage = document.getElementById('headerProfileImage');
        var headerProfileIcon = document.getElementById('headerProfileIcon');
        var modalProfileImage = document.getElementById('modalProfileImage');
        var modalProfilePlaceholder = document.getElementById('modalProfilePlaceholder');
        
        if (currentUser.profileImage) {
            // í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš°
            if (profileImage && profilePlaceholder) {
                profileImage.src = currentUser.profileImage;
                profileImage.classList.remove('hidden');
                profilePlaceholder.classList.add('hidden');
            }
            
            if (headerProfileImage && headerProfileIcon) {
                headerProfileImage.src = currentUser.profileImage;
                headerProfileImage.classList.remove('hidden');
                headerProfileIcon.classList.add('hidden');
            }
            
            if (modalProfileImage && modalProfilePlaceholder) {
                modalProfileImage.src = currentUser.profileImage;
                modalProfileImage.classList.remove('hidden');
                modalProfilePlaceholder.classList.add('hidden');
            }
        } else {
            // í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ì—†ëŠ” ê²½ìš°
            if (profileImage && profilePlaceholder) {
                profileImage.classList.add('hidden');
                profilePlaceholder.classList.remove('hidden');
            }
            
            if (headerProfileImage && headerProfileIcon) {
                headerProfileImage.classList.add('hidden');
                headerProfileIcon.classList.remove('hidden');
            }
            
            if (modalProfileImage && modalProfilePlaceholder) {
                modalProfileImage.classList.add('hidden');
                modalProfilePlaceholder.classList.remove('hidden');
            }
        }
        
    } catch (error) {
        console.error('í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
    }
}

// ë ˆë²¨ í‘œì‹œ ì—…ë°ì´íŠ¸
function updateLevelDisplay() {
    try {
        var level = levelSystem[userLevel];
        if (!level) return;
        
        var levelElements = document.querySelectorAll('#userLevel, #navLevelBadge');
        
        levelElements.forEach(function(element) {
            if (element) {
                element.className = element.className.includes('level-badge-profile') ? 
                    'level-badge-profile ' + level.class : 
                    'level-badge-nav ' + level.class;
                element.textContent = level.name;
            }
        });
        
        var expElement = document.getElementById('userExp');
        if (expElement) {
            expElement.textContent = userExp + ' / ' + level.max + ' EXP';
        }
    } catch (error) {
        console.error('ë ˆë²¨ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
    }
}

// ìì‚° í‘œì‹œ ì—…ë°ì´íŠ¸
function updateAssetsDisplay() {
    try {
        // ì´ ìì‚° í‘œì‹œ
        var totalAssetsElement = document.getElementById('totalAssets');
        if (totalAssetsElement) {
            totalAssetsElement.textContent = totalAssets.toLocaleString() + 'ì›';
        }
        
        // í˜„ê¸ˆ í‘œì‹œ
        var cashAmountElement = document.getElementById('cashAmount');
        if (cashAmountElement) {
            cashAmountElement.textContent = cash.toLocaleString() + 'ì›';
        }
        
        // ìˆ˜ìµë¥  ê³„ì‚°
        var initialAmount = currentUser.id === 'test' ? 100000000 : 10000000;
        var profitLoss = totalAssets - initialAmount;
        var profitRate = (profitLoss / initialAmount * 100).toFixed(2);
        var profitText = (profitLoss >= 0 ? '+' : '') + profitLoss.toLocaleString() + 'ì› (' + profitRate + '%)';
        var profitClass = profitLoss >= 0 ? 'text-red-600' : 'text-blue-600';
        
        var profitElement = document.getElementById('totalProfitLoss');
        if (profitElement) {
            profitElement.textContent = profitText;
            profitElement.className = 'font-semibold ' + profitClass;
        }
        
        // ìì‚° ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        updateAssetsList();
        
    } catch (error) {
        console.error('ìì‚° ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
    }
}

// ìì‚° ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
function updateAssetsList() {
    try {
        var assetsList = document.getElementById('assetsList');
        if (!assetsList) return;
        
        var assetsHTML = '';
        
        // í˜„ê¸ˆ ìì‚° í‘œì‹œ
        assetsHTML += '<div class="bg-white rounded-xl p-4 card-shadow asset-category asset-cash">';
        assetsHTML += '<div class="flex justify-between items-center">';
        assetsHTML += '<div><p class="font-semibold">í˜„ê¸ˆ</p><p class="text-sm text-gray-500">ë³´ìœ  í˜„ê¸ˆ</p></div>';
        assetsHTML += '<div class="text-right"><p class="font-bold">' + cash.toLocaleString() + 'ì›</p></div>';
        assetsHTML += '</div></div>';
        
        // íˆ¬ì ìì‚° í‘œì‹œ
        if (currentUser.portfolio) {
            Object.keys(currentUser.portfolio).forEach(function(type) {
                var holdings = currentUser.portfolio[type];
                if (holdings && holdings.length > 0) {
                    holdings.forEach(function(holding) {
                        var currentPrice = getCurrentPrice(type, holding.productId);
                        var totalValue = holding.quantity * currentPrice;
                        var profit = totalValue - (holding.quantity * holding.avgPrice);
                        var profitRate = ((profit / (holding.quantity * holding.avgPrice)) * 100).toFixed(2);
                        
                        var typeNames = {
                            deposit: 'ì˜ˆì ê¸ˆ',
                            stock: 'ì£¼ì‹',
                            bond: 'ì±„ê¶Œ',
                            etf: 'ETF/í€ë“œ',
                            crypto: 'ì•”í˜¸í™”í',
                            commodity: 'ê·€ê¸ˆì†/ì›ìì¬'
                        };
                        
                        var profitClass = profit >= 0 ? 'text-red-600' : 'text-blue-600';
                        var profitIcon = profit >= 0 ? '+' : '';
                        
                        assetsHTML += '<div class="bg-white rounded-xl p-4 card-shadow asset-category asset-' + type + '">';
                        assetsHTML += '<div class="flex justify-between items-center">';
                        assetsHTML += '<div><p class="font-semibold">' + holding.productName + '</p>';
                        assetsHTML += '<p class="text-sm text-gray-500">' + typeNames[type] + ' Â· ' + holding.quantity + 'ê°œ</p></div>';
                        assetsHTML += '<div class="text-right">';
                        assetsHTML += '<p class="font-bold">' + totalValue.toLocaleString() + 'ì›</p>';
                        assetsHTML += '<p class="text-sm ' + profitClass + '">' + profitIcon + profit.toLocaleString() + 'ì› (' + profitRate + '%)</p>';
                        assetsHTML += '</div></div></div>';
                    });
                }
            });
        }
        
        assetsList.innerHTML = assetsHTML;
        
    } catch (error) {
        console.error('ìì‚° ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
    }
}

// í¬íŠ¸í´ë¦¬ì˜¤ í‘œì‹œ ì—…ë°ì´íŠ¸
function updatePortfolioDisplay() {
    try {
        setTimeout(function() {
            initPortfolioChart();
        }, 100);
        
        var portfolioDetails = document.getElementById('portfolioDetails');
        if (!portfolioDetails) return;
        
        var detailsHTML = '';
        var typeNames = {
            deposit: 'ì˜ˆì ê¸ˆ',
            stock: 'ì£¼ì‹',
            bond: 'ì±„ê¶Œ',
            etf: 'ETF/í€ë“œ',
            crypto: 'ì•”í˜¸í™”í',
            commodity: 'ê·€ê¸ˆì†/ì›ìì¬'
        };
        
        // í˜„ê¸ˆ ë¹„ì¤‘
        var cashRatio = (cash / totalAssets * 100).toFixed(1);
        detailsHTML += '<div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">';
        detailsHTML += '<div class="flex items-center space-x-2">';
        detailsHTML += '<div class="w-4 h-4 bg-gray-400 rounded-full"></div>';
        detailsHTML += '<span class="font-semibold">í˜„ê¸ˆ</span></div>';
        detailsHTML += '<span class="font-bold">' + cashRatio + '%</span></div>';
        
        // íˆ¬ì ìì‚° ë¹„ì¤‘
        if (currentUser.portfolio) {
            Object.keys(currentUser.portfolio).forEach(function(type) {
                var holdings = currentUser.portfolio[type];
                if (holdings && holdings.length > 0) {
                    var typeValue = 0;
                    holdings.forEach(function(holding) {
                        var currentPrice = getCurrentPrice(type, holding.productId);
                        typeValue += holding.quantity * currentPrice;
                    });
                    
                    if (typeValue > 0) {
                        var typeRatio = (typeValue / totalAssets * 100).toFixed(1);
                        var colors = {
                            deposit: '#8B5CF6',
                            stock: '#3B82F6',
                            bond: '#10B981',
                            etf: '#F59E0B',
                            crypto: '#EF4444',
                            commodity: '#6B7280'
                        };
                        
                        detailsHTML += '<div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">';
                        detailsHTML += '<div class="flex items-center space-x-2">';
                        detailsHTML += '<div class="w-4 h-4 rounded-full" style="background-color: ' + colors[type] + '"></div>';
                        detailsHTML += '<span class="font-semibold">' + typeNames[type] + '</span></div>';
                        detailsHTML += '<span class="font-bold">' + typeRatio + '%</span></div>';
                    }
                }
            });
        }
        
        portfolioDetails.innerHTML = detailsHTML;
        
    } catch (error) {
        console.error('í¬íŠ¸í´ë¦¬ì˜¤ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
    }
}

// í¬íŠ¸í´ë¦¬ì˜¤ ì°¨íŠ¸ ì´ˆê¸°í™”
function initPortfolioChart() {
    try {
        var canvas = document.getElementById('portfolioChart');
        if (!canvas) return;
        
        var ctx = canvas.getContext('2d');
        
        if (portfolioChart) {
            portfolioChart.destroy();
        }
        
        var labels = ['í˜„ê¸ˆ'];
        var data = [cash];
        var colors = ['#6B7280'];
        
        // íˆ¬ì ìì‚° ì¶”ê°€
        if (currentUser.portfolio) {
            var typeNames = {
                deposit: 'ì˜ˆì ê¸ˆ',
                stock: 'ì£¼ì‹',
                bond: 'ì±„ê¶Œ',
                etf: 'ETF/í€ë“œ',
                crypto: 'ì•”í˜¸í™”í',
                commodity: 'ê·€ê¸ˆì†/ì›ìì¬'
            };
            
            var typeColors = {
                deposit: '#8B5CF6',
                stock: '#3B82F6',
                bond: '#10B981',
                etf: '#F59E0B',
                crypto: '#EF4444',
                commodity: '#6B7280'
            };
            
            Object.keys(currentUser.portfolio).forEach(function(type) {
                var holdings = currentUser.portfolio[type];
                if (holdings && holdings.length > 0) {
                    var typeValue = 0;
                    holdings.forEach(function(holding) {
                        var currentPrice = getCurrentPrice(type, holding.productId);
                        typeValue += holding.quantity * currentPrice;
                    });
                    
                    if (typeValue > 0) {
                        labels.push(typeNames[type]);
                        data.push(typeValue);
                        colors.push(typeColors[type]);
                    }
                }
            });
        }
        
        portfolioChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: colors,
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true
                        }
                    }
                }
            }
        });
        
    } catch (error) {
        console.error('í¬íŠ¸í´ë¦¬ì˜¤ ì°¨íŠ¸ ì˜¤ë¥˜:', error);
    }
}

// ìì‚° ìƒˆë¡œê³ ì¹¨
function refreshAssets() {
    try {
        // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        var savedData = localStorage.getItem('user_' + currentUser.id);
        if (savedData) {
            var userData = JSON.parse(savedData);
            currentUser = Object.assign(currentUser, userData);
            
            // ì „ì—­ ë³€ìˆ˜ ë™ê¸°í™”
            cash = currentUser.cash || currentUser.virtualBalance || 10000000;
            syncPortfolioData();
            updateDisplay();
        }
        
        // ìƒˆë¡œê³ ì¹¨ ì•„ì´ì½˜ íšŒì „ íš¨ê³¼
        var refreshIcon = document.querySelector('button[onclick="refreshAssets()"] i');
        if (refreshIcon) {
            refreshIcon.style.transform = 'rotate(360deg)';
            refreshIcon.style.transition = 'transform 0.5s ease';
            setTimeout(function() {
                refreshIcon.style.transform = 'rotate(0deg)';
            }, 500);
        }
        
    } catch (error) {
        console.error('ìì‚° ìƒˆë¡œê³ ì¹¨ ì˜¤ë¥˜:', error);
    }
}

// í”„ë¡œí•„ ë©”ë‰´ í† ê¸€
function toggleProfileMenu() {
    try {
        var menu = document.getElementById('profileMenu');
        if (menu) {
            if (menu.classList.contains('show')) {
                menu.classList.remove('show');
            } else {
                menu.classList.add('show');
            }
        }
    } catch (error) {
        console.error('í”„ë¡œí•„ ë©”ë‰´ í† ê¸€ ì˜¤ë¥˜:', error);
    }
}

// ë¡œê·¸ì•„ì›ƒ
function logout() {
    try {
        // ì‚¬ìš©ì ë°ì´í„° ì €ì¥
        saveUserData();
        
        // ì¸í„°ë²Œ ì •ë¦¬
        if (dataRefreshInterval) {
            clearInterval(dataRefreshInterval);
        }
        
        // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì‚­ì œ
        localStorage.removeItem('fineu_current_user');
        
        // ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
        var loginScreen = document.getElementById('loginScreen');
        var mainScreen = document.getElementById('mainScreen');
        
        if (mainScreen) {
            mainScreen.classList.remove('active');
        }
        
        if (loginScreen) {
            loginScreen.classList.add('active');
        }
        
        // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
        var userIdInput = document.getElementById('userId');
        var passwordInput = document.getElementById('userPassword');
        if (userIdInput) userIdInput.value = '';
        if (passwordInput) passwordInput.value = '';
        
        // í”„ë¡œí•„ ë©”ë‰´ ìˆ¨ê¸°ê¸°
        hideProfileMenu();
        
    } catch (error) {
        console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
    }
}

// í”„ë¡œí•„ ë©”ë‰´ ìˆ¨ê¸°ê¸°
function hideProfileMenu() {
    var menu = document.getElementById('profileMenu');
    if (menu) {
        menu.classList.remove('show');
    }
}

// ì‚¬ìš©ì ë°ì´í„° ì €ì¥
function saveUserData() {
    try {
        if (currentUser) {
            // í˜„ì¬ ìƒíƒœë¥¼ ì‚¬ìš©ì ë°ì´í„°ì— ë°˜ì˜
            currentUser.level = userLevel;
            currentUser.exp = userExp;
            currentUser.totalAssets = totalAssets;
            currentUser.cash = cash;
            currentUser.virtualBalance = cash; // í˜¸í™˜ì„±ì„ ìœ„í•´
            
            localStorage.setItem('user_' + currentUser.id, JSON.stringify(currentUser));
            localStorage.setItem('fineu_current_user', JSON.stringify(currentUser));
        }
    } catch (error) {
        console.error('ë°ì´í„° ì €ì¥ ì˜¤ë¥˜:', error);
    }
}

// í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ
function uploadProfileImage() {
    var fileInput = document.getElementById('imageUpload');
    if (fileInput) {
        fileInput.click();
    }
}

// ëª¨ë‹¬ì—ì„œ í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ
function uploadProfileImageFromModal() {
    var fileInput = document.getElementById('imageUpload');
    if (fileInput) {
        fileInput.click();
    }
}

// ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
function handleImageUpload(event) {
    try {
        var file = event.target.files[0];
        if (!file) return;
        
        // íŒŒì¼ í¬ê¸° í™•ì¸ (5MB ì œí•œ)
        if (file.size > 5 * 1024 * 1024) {
            alert('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. 5MB ì´í•˜ì˜ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }
        
        // íŒŒì¼ íƒ€ì… í™•ì¸
        if (!file.type.startsWith('image/')) {
            alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            return;
        }
        
        var reader = new FileReader();
        reader.onload = function(e) {
            var imageData = e.target.result;
            
            // í˜„ì¬ ì‚¬ìš©ìì—ê²Œ í”„ë¡œí•„ ì´ë¯¸ì§€ ì €ì¥
            if (currentUser) {
                currentUser.profileImage = imageData;
                saveUserData();
                updateProfileImage();
                alert('í”„ë¡œí•„ ì‚¬ì§„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        };
        
        reader.readAsDataURL(file);
        
    } catch (error) {
        console.error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}

// ê¸°íƒ€ í•¨ìˆ˜ë“¤
function showRegisterModal() {
    var modal = document.getElementById('registerModal');
    if (modal) {
        modal.classList.remove('hidden');
    }
}

function hideRegisterModal() {
    var modal = document.getElementById('registerModal');
    if (modal) {
        modal.classList.add('hidden');
    }
}

function showFindModal() {
    var modal = document.getElementById('findModal');
    if (modal) {
        modal.classList.remove('hidden');
    }
}

function hideFindModal() {
    var modal = document.getElementById('findModal');
    if (modal) {
        modal.classList.add('hidden');
    }
}

function showProfileModal() {
    hideProfileMenu();
    var modal = document.getElementById('profileModal');
    if (modal) {
        // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ë¡œ ëª¨ë‹¬ ì—…ë°ì´íŠ¸
        var modalUserName = document.getElementById('modalUserName');
        if (modalUserName && currentUser) {
            modalUserName.value = currentUser.name;
        }
        
        modal.classList.remove('hidden');
    }
}

function hideProfileModal() {
    var modal = document.getElementById('profileModal');
    if (modal) {
        modal.classList.add('hidden');
    }
}

function register() {
    alert('íšŒì›ê°€ì… ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    hideRegisterModal();
}

function findAccount() {
    alert('ê³„ì • ì°¾ê¸° ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    hideFindModal();
}

function updateProfile() {
    try {
        var modalUserName = document.getElementById('modalUserName');
        if (modalUserName && currentUser) {
            var newName = modalUserName.value.trim();
            if (newName && newName !== currentUser.name) {
                currentUser.name = newName;
                saveUserData();
                updateDisplay();
                alert('í”„ë¡œí•„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }
        hideProfileModal();
    } catch (error) {
        console.error('í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
        alert('í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    try {
        // ìë™ ë¡œê·¸ì¸ í™•ì¸
        if (!checkAutoLogin()) {
            // ìë™ ë¡œê·¸ì¸ì´ ì‹¤íŒ¨í•œ ê²½ìš° ë¡œê·¸ì¸ í™”ë©´ ìœ ì§€
            console.log('ìë™ ë¡œê·¸ì¸ ì‹¤íŒ¨ - ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ');
        }
        
        // ì—”í„° í‚¤ ì´ë²¤íŠ¸
        var passwordInput = document.getElementById('userPassword');
        if (passwordInput) {
            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performLogin();
                }
            });
        }
        
        // ì™¸ë¶€ í´ë¦­ì‹œ í”„ë¡œí•„ ë©”ë‰´ ìˆ¨ê¸°ê¸°
        document.addEventListener('click', function(e) {
            var profileMenu = document.getElementById('profileMenu');
            var profileButton = document.querySelector('button[onclick="toggleProfileMenu()"]');
            
            if (profileMenu && profileMenu.classList.contains('show')) {
                if (!profileMenu.contains(e.target) && !profileButton.contains(e.target)) {
                    hideProfileMenu();
                }
            }
        });
        
    } catch (error) {
        console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
    }
});

// ìºì‹œ ìš°íšŒë¥¼ ìœ„í•œ ê°•ì œ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
function forceRefresh() {
    window.location.reload(true);
}

// í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ë°ì´í„° ì €ì¥
window.addEventListener('beforeunload', function() {
    saveUserData();
    if (dataRefreshInterval) {
        clearInterval(dataRefreshInterval);
    }
});
</script>

</body>
</html>
